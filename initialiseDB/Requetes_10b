USE OpenVet10b;
SET profiling = 1;
-- Vider cache
RESET QUERY CACHE;
SELECT Nom,Prenom,(SELECT Commune FROM Commune WHERE idCommune=Client.Commune_idCommune) As Commune
FROM Client WHERE Nom LIKE 'F%';
RESET QUERY CACHE;
SELECT (SELECT CiviliteAbrev FROM Civilite WHERE idCivilite=Civilite_idCivilite) As Civilite,
Nom,Prenom,Adresse,
(SELECT CIP FROM Commune WHERE idCommune=Commune_idCommune) As CodePostal,
(SELECT Commune FROM Commune WHERE idCommune=Commune_idCommune) As Commune,Remarque,
(SELECT GROUP_CONCAT(Telephone) FROM Repertoire WHERE id=idClient AND RefTable='Client') AS Telephones,
(SELECT GROUP_CONCAT(IsPrincipal) FROM Repertoire WHERE id=idClient AND RefTable='Client') AS Main,
(SELECT GROUP_CONCAT(Email) FROM Repertoire WHERE id=idClient AND RefTable='Client') AS Email
FROM Client Where idClient=600;
RESET QUERY CACHE;
SELECT idAnimal,Nom,
(SELECT Espece FROM Especes WHERE idEspeces=Especes_idEspeces),
(SELECT Race FROM Race WHERE idRace=Race_idRace),Sexe,Naissance,Sterilise,Identification,Remarque
 FROM Animal WHERE idAnimal IN (SELECT Animal_idAnimal FROM ClientAnimalRef WHERE Client_idClient=500);
-- Pour les relations n:n préférer les jointures aux requetes imbriquées
RESET QUERY CACHE;
SELECT idAnimal,Animal.Nom,
(SELECT Espece FROM Especes WHERE idEspeces=Especes_idEspeces),
(SELECT Race FROM Race WHERE idRace=Race_idRace),Sexe,Naissance,Sterilise,Identification,Animal.Remarque
FROM Animal
INNER JOIN ClientAnimalRef AS Ref ON Animal.idAnimal=Ref.Animal_idAnimal
INNER JOIN Client ON Ref.Client_idClient=500;

SHOW PROFILES;
SET profiling = 0;