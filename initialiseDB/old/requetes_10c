USE OpenVet10c;
SET profiling = 1;
-- Vider cache
RESET QUERY CACHE;
SELECT Nom,Prenom,
(SELECT Commune FROM Commune,Adresse WHERE idCommune=Adresse.Commune_idCommune AND Adresse.id=Client.idClient AND RefTable='Client') As Commune
FROM Client WHERE Nom LIKE 'R%';
-- optimisation avec jointures
RESET QUERY CACHE;
SELECT Client.Nom,Client.Prenom,Commune.Commune FROM Client
INNER JOIN Adresse ON id=Client.idClient
INNER JOIN Commune ON idCommune=Adresse.Commune_idCommune
WHERE Nom LIKE 'R%';

SELECT (SELECT CiviliteAbrev FROM Civilite WHERE idCivilite=Civilite_idCivilite) As Civilite,
Nom,Prenom,
(SELECT CIP FROM Commune,Adresse WHERE idCommune=Commune_idCommune AND Adresse.id=Client.idClient AND RefTable='Client') As CodePostal,
(SELECT Commune FROM Commune,Adresse WHERE idCommune=Adresse.Commune_idCommune AND Adresse.id=Client.idClient AND RefTable='Client') As Commune,
(SELECT NomRue FROM NomRue,Adresse WHERE idNomRue=Adresse.NomRue_idNomRue AND Adresse.id=Client.idClient AND RefTable='Client') As Voie,
Remarque,
(SELECT GROUP_CONCAT(Telephone) FROM Repertoire WHERE id=idClient AND RefTable='Client') AS Telephones,
(SELECT GROUP_CONCAT(IsPrincipal) FROM Repertoire WHERE id=idClient AND RefTable='Client') AS Main,
(SELECT GROUP_CONCAT(Email) FROM Repertoire WHERE id=idClient AND RefTable='Client') AS Email
FROM Client Where idClient=600;
RESET QUERY CACHE;
SELECT idAnimal,Nom,
(SELECT Espece FROM Especes WHERE idEspeces=Especes_idEspeces),
(SELECT Race FROM Race WHERE idRace=Race_idRace),Sexe,Naissance,Sterilise,Identification,Remarque
 FROM Animal WHERE idAnimal IN (SELECT Animal_idAnimal FROM ClientAnimalRef WHERE Client_idClient=500);

SHOW PROFILES;
SET profiling = 0;

SELECT table_name AS "Tables", round(((data_length + index_length) / 1024 / 1024), 2) AS "Size (MB)" 
FROM information_schema.tables 
WHERE table_schema =  'OpenVet10c';